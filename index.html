<!DOCTYPE html>
<html lang="es">
<head>
    <link href="https://fonts.googleapis.com/css?family=Montserrat&display=swap" rel="stylesheet">
    <link href="micromodal.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsrender/1.0.4/jsrender.min.js" integrity="sha256-s+wXPcRhQXvh1VlUAEpAIwi8DaDCxbNpB4QsJ6Kwdro=" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/micromodal/dist/micromodal.min.js"></script>


    <title>Actividades propuestas</title>
    <style>
        #talks {
            list-style: none;
            margin: 0;
            padding: 0;
        }
        #talks li{
            border: 1px dotted #ccc;
            width: 300px;
        }
        #talks img{

            background-color: #ccc;
            background: url('data:image/png;base64,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')
        }
        #talks li{
            display: inline-block;
            margin-right: 1rem;
        }

        #talks li iframe{
            margin-left: 10px;
        }
        #talks img,
        .talk-title,
        .talk-description{
            cursor: pointer;
        }
        h1,
        .talk-title{
            font-family: 'Montserrat', sans-serif;
        }
        body{
            font-family: 'Courier New';
        }
        .talk-title{
            text-align: center;
            line-height: 1.5rem;
            text-transform: uppercase;
            background-color: #DB4367;
            color: white;
            margin-top: 0;
            margin-top: -4px;
            padding: .5rem;
        }
        .talk-description{
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            font-size: .85rem;
            padding: 0 1rem;
            line-height: 1.25rem;
        }
        .fb-buttons{
            text-align: center;
            height:28px;
            margin-bottom: 1rem;
        }
        .acenter{
            text-align: center;
        }
        .intro{
            line-height: 1.35rem;
            margin-bottom: 2rem;
        }
        .intro strong{
            background-color: #DB4367;
            color: white;
        }
        #modal-content strong {
            margin-top: 1rem;
            display: inline-block;
        }
    </style>

</head>

<body>
    <div id="fb-root"></div>
    <script async defer crossorigin="anonymous" src="https://connect.facebook.net/es_LA/sdk.js#xfbml=1&version=v4.0"></script>

    <h1 class="acenter">Actividades propuestas</h1>
    <p class="acenter intro">
        A continuación puedes ver un listado de actividades que se han propuesto
        para organizar desde la asociación. Tu ayuda es muy importante, por eso
        <strong>nos gustaría pedirte que indiques qué charlas te interesan con un "Me gusta" y que nos
        ayudes a encontrar a más gente interesada compartiendo aquellas charlas
        que le puedan interesar a tus contactos</strong>. Y por supuesto, si quieres
        también puedes <a href="https://docs.google.com/forms/d/e/1FAIpQLSfVVcG87y4tkRDAELX8nZq276o9oL0_BkOxc2497rv4arPbYg/viewform">envíar tú una propuesta</a>.
    </p>

    <ul id="talks"></ul>


    <script id="talkTmpl" type="text/x-jsrender">
        {{for talks}}
        <li
            data-length = "{{:length}}"
            data-speakers = "{{:speakers}}"
            data-categories = "{{:categories}}"
            data-level = "{{:level}}"
            data-comments = "{{:comments}}"
        >
            <img src="https://source.unsplash.com/300x200/?{{:tags}}" width="300" height="200" onclick="showModal({{:index}})">
            <p class="talk-title" style="background-color: {{:titleColor}}" onclick="showModal({{:index}})">{{:title}}</p>
            <p class="talk-description" onclick="showModal({{:index}})">{{:description}}</p>
            <div class="fb-buttons">
                <div class="fb-like" data-href="https://www.facebook.com/plugins/like.php?href=https%3A%2F%2Ftomellosotech.org%2Fcharla%2F{{:title}}" data-width="" data-layout="button" data-action="like" data-size="large" data-show-faces="true" data-share="true"></div>
            </div>
        </li>
        {{/for}}
</script>

<div class="modal micromodal-slide" id="modal" aria-hidden="true">
    <div class="modal__overlay" tabindex="-1" data-micromodal-close>
      <div class="modal__container" role="dialog" aria-modal="true" aria-labelledby="modal-title">
        <header class="modal__header">
          <h2 class="modal__title" id="modal-title">
            Micromodal
          </h2>
          <button class="modal__close" aria-label="Close modal" data-micromodal-close></button>
        </header>

        <main class="modal__content" id="modal-content">
          <div>
            <strong>Descripción:</strong><br>
            <div id="modal-description"></div>
          </div>
          <div>
            <strong>Nivel de dificultad:</strong> <span id="modal-level"></span>
          </div>
          <div>
              <strong>Duración:</strong> <span id="modal-length"></span>
          </div>
          <div>
              <strong>Ponentes(s):</strong><br>
              <div id="modal-speakers"></div>
          </div>
          <div>
              <strong>Categoría(s):</strong><br>
              <div id="modal-categories"></div>
          </div>

          <div>
              <strong>Otros comentarios:</strong><br>
              <div id="modal-comments"></div>
          </div>
        </main>

        <footer class="modal__footer">
          <button class="modal__btn" data-micromodal-close aria-label="Close this dialog window">Cerrar</button>
        </footer>
      </div>
    </div>
  </div>

<script>

    const talksUrl = 'https://spreadsheets.google.com/feeds/list/1_jMY6CMf9oKhDxzn_NRrUPtu6f-h8cxVkqy7KOE_m2U/1/public/values?alt=json-in-script&callback=loadTalks';
    $.ajax({
        url: talksUrl,
        jsonp: "loadTalks",
        dataType: "jsonp",
        data: {format: "json"}
    });

    function loadTalks(data){
        window.talks = [];

        const tags = [
            ['Herramientas y lenguajes de programación', 'programming,development'],
            ['Tendencias tecnológicas', 'vr,bigdata'],
            ['Robótica, electrónica', 'robotics,electronic'],
            ['Herramientas y técnicas de productividad', 'productivity,post-it'],
            ['Marketing online', 'marketing'],
            ['Diseño gráfico', 'design'],
            ['Emprendimiento', 'business'],
            ['Buen uso de la tecnología', 'security,privacy']
        ];

        const colorPalette = ['#DB4367', '#EB4B38', '#AC4988', '#705390', '#3F5279', '#2F4857'];

        data.feed.entry.forEach(element => {
            let talkTags = [];
            let talk = {
                index: talks.length,
                title: element.gsx$title.$t,
                description: element.gsx$description.$t,
                length: element.gsx$length.$t,
                speakers: element.gsx$speakers.$t,
                categories: element.gsx$categories.$t,
                level: element.gsx$level.$t,
                comments: element.gsx$comments.$t
            };

            tags.forEach(tag => {
                if(talk.categories.indexOf(tag[0]) != -1){
                    talkTags = talkTags.concat(tag[1].split(','));
                }
            });
            talk.titleColor = colorPalette[getRandomInt(0, colorPalette.length)];
            talk.tags = talkTags.join(',');

            talk['description'] = linkify(talk['description']);
            talk['description'] = talk['description'].replace(/(?:\r\n|\r|\n)/g, '<br>');

            talks.push(talk)
        });

        const template = $.templates("#talkTmpl");
        const htmlOutput = template.render({talks});
        $("#talks").html(htmlOutput);
    }

    function linkify(inputText) {
        var replacedText, replacePattern1, replacePattern2, replacePattern3;

        //URLs starting with http://, https://, or ftp://
        replacePattern1 = /(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim;
        replacedText = inputText.replace(replacePattern1, '<a href="$1" target="_blank">$1</a>');

        //URLs starting with "www." (without // before it, or it'd re-link the ones done above).
        replacePattern2 = /(^|[^\/])(www\.[\S]+(\b|$))/gim;
        replacedText = replacedText.replace(replacePattern2, '$1<a href="http://$2" target="_blank">$2</a>');

        //Change email addresses to mailto:: links.
        replacePattern3 = /(([a-zA-Z0-9\-\_\.])+@[a-zA-Z\_]+?(\.[a-zA-Z]{2,6})+)/gim;
        replacedText = replacedText.replace(replacePattern3, '<a href="mailto:$1">$1</a>');

        return replacedText;
    }

    function getRandomInt(min, max) {
        min = Math.ceil(min);
        max = Math.floor(max);
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function showModal(id) {
        [
            'title', 'description', 'level', 'length', 'speakers',
            'categories', 'comments'
        ].forEach( attr => {
            let output = linkify(talks[id][attr]);
            output = output.replace(/(?:\r\n|\r|\n)/g, '<br>');
            output = output? output : 'n.a.'
            document.getElementById(`modal-${attr}`).innerHTML = output;
        })

        MicroModal.show('modal');
        console.log(talks[id]);
    }
</script>
</body>
</html>
